<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# metric

```go
import "github.com/ccheers/xpkg/stat/metric"
```

## Index

- [func Avg(iterator Iterator) float64](<#func-avg>)
- [func Count(iterator Iterator) float64](<#func-count>)
- [func Max(iterator Iterator) float64](<#func-max>)
- [func Min(iterator Iterator) float64](<#func-min>)
- [func Sum(iterator Iterator) float64](<#func-sum>)
- [type Aggregation](<#type-aggregation>)
- [type Bucket](<#type-bucket>)
  - [func (b *Bucket) Add(offset int, val float64)](<#func-bucket-add>)
  - [func (b *Bucket) Append(val float64)](<#func-bucket-append>)
  - [func (b *Bucket) Next() *Bucket](<#func-bucket-next>)
  - [func (b *Bucket) Reset()](<#func-bucket-reset>)
- [type Counter](<#type-counter>)
  - [func NewCounter(opts CounterOpts) Counter](<#func-newcounter>)
- [type CounterOpts](<#type-counteropts>)
- [type CounterVec](<#type-countervec>)
  - [func NewBusinessMetricCount(name string, labels ...string) CounterVec](<#func-newbusinessmetriccount>)
  - [func NewCounterVec(cfg *CounterVecOpts) CounterVec](<#func-newcountervec>)
- [type CounterVecOpts](<#type-countervecopts>)
- [type Gauge](<#type-gauge>)
  - [func NewGauge(opts GaugeOpts) Gauge](<#func-newgauge>)
- [type GaugeOpts](<#type-gaugeopts>)
- [type GaugeVec](<#type-gaugevec>)
  - [func NewBusinessMetricGauge(name string, labels ...string) GaugeVec](<#func-newbusinessmetricgauge>)
  - [func NewGaugeVec(cfg *GaugeVecOpts) GaugeVec](<#func-newgaugevec>)
- [type GaugeVecOpts](<#type-gaugevecopts>)
- [type HistogramVec](<#type-histogramvec>)
  - [func NewBusinessMetricHistogram(name string, buckets []float64, labels ...string) HistogramVec](<#func-newbusinessmetrichistogram>)
  - [func NewHistogramVec(cfg *HistogramVecOpts) HistogramVec](<#func-newhistogramvec>)
- [type HistogramVecOpts](<#type-histogramvecopts>)
- [type Iterator](<#type-iterator>)
  - [func (i *Iterator) Bucket() Bucket](<#func-iterator-bucket>)
  - [func (i *Iterator) Next() bool](<#func-iterator-next>)
- [type Metric](<#type-metric>)
- [type Opts](<#type-opts>)
- [type PointGauge](<#type-pointgauge>)
  - [func NewPointGauge(opts PointGaugeOpts) PointGauge](<#func-newpointgauge>)
- [type PointGaugeOpts](<#type-pointgaugeopts>)
- [type PointPolicy](<#type-pointpolicy>)
  - [func NewPointPolicy(window *Window) *PointPolicy](<#func-newpointpolicy>)
  - [func (p *PointPolicy) Append(val float64)](<#func-pointpolicy-append>)
  - [func (p *PointPolicy) Reduce(f func(Iterator) float64) float64](<#func-pointpolicy-reduce>)
- [type RollingCounter](<#type-rollingcounter>)
  - [func NewRollingCounter(opts RollingCounterOpts) RollingCounter](<#func-newrollingcounter>)
- [type RollingCounterOpts](<#type-rollingcounteropts>)
- [type RollingGauge](<#type-rollinggauge>)
  - [func NewRollingGauge(opts RollingGaugeOpts) RollingGauge](<#func-newrollinggauge>)
- [type RollingGaugeOpts](<#type-rollinggaugeopts>)
- [type RollingPolicy](<#type-rollingpolicy>)
  - [func NewRollingPolicy(window *Window, opts RollingPolicyOpts) *RollingPolicy](<#func-newrollingpolicy>)
  - [func (r *RollingPolicy) Add(val float64)](<#func-rollingpolicy-add>)
  - [func (r *RollingPolicy) Append(val float64)](<#func-rollingpolicy-append>)
  - [func (r *RollingPolicy) Reduce(f func(Iterator) float64) (val float64)](<#func-rollingpolicy-reduce>)
- [type RollingPolicyOpts](<#type-rollingpolicyopts>)
- [type VectorOpts](<#type-vectoropts>)
- [type Window](<#type-window>)
  - [func NewWindow(opts WindowOpts) *Window](<#func-newwindow>)
  - [func (w *Window) Add(offset int, val float64)](<#func-window-add>)
  - [func (w *Window) Append(offset int, val float64)](<#func-window-append>)
  - [func (w *Window) Bucket(offset int) Bucket](<#func-window-bucket>)
  - [func (w *Window) Iterator(offset int, count int) Iterator](<#func-window-iterator>)
  - [func (w *Window) ResetBucket(offset int)](<#func-window-resetbucket>)
  - [func (w *Window) ResetBuckets(offsets []int)](<#func-window-resetbuckets>)
  - [func (w *Window) ResetWindow()](<#func-window-resetwindow>)
  - [func (w *Window) Size() int](<#func-window-size>)
- [type WindowOpts](<#type-windowopts>)


## func Avg

```go
func Avg(iterator Iterator) float64
```

Avg the values within the window.

## func Count

```go
func Count(iterator Iterator) float64
```

Count sums the count value within the window.

## func Max

```go
func Max(iterator Iterator) float64
```

Max the values within the window.

## func Min

```go
func Min(iterator Iterator) float64
```

Min the values within the window.

## func Sum

```go
func Sum(iterator Iterator) float64
```

Sum the values within the window.

## type Aggregation

Aggregation contains some common pipeline function. Each pipeline can compute summary statistics of window.

```go
type Aggregation interface {
    // Min finds the min value within the window.
    Min() float64
    // Max finds the max value within the window.
    Max() float64
    // Avg computes average value within the window.
    Avg() float64
    // Sum computes sum value within the window.
    Sum() float64
}
```

## type Bucket

Bucket contains multiple float64 points.

```go
type Bucket struct {
    Points []float64
    Count  int64
    // contains filtered or unexported fields
}
```

### func \(\*Bucket\) Add

```go
func (b *Bucket) Add(offset int, val float64)
```

Add adds the given value to the point.

### func \(\*Bucket\) Append

```go
func (b *Bucket) Append(val float64)
```

Append appends the given value to the bucket.

### func \(\*Bucket\) Next

```go
func (b *Bucket) Next() *Bucket
```

Next returns the next bucket.

### func \(\*Bucket\) Reset

```go
func (b *Bucket) Reset()
```

Reset empties the bucket.

## type Counter

Counter stores a numerical value that only ever goes up.

```go
type Counter interface {
    Metric
}
```

### func NewCounter

```go
func NewCounter(opts CounterOpts) Counter
```

NewCounter creates a new Counter based on the CounterOpts.

## type CounterOpts

CounterOpts is an alias of Opts.

```go
type CounterOpts Opts
```

## type CounterVec

CounterVec counter vec.

```go
type CounterVec interface {
    // Inc increments the counter by 1. Use Add to increment it by arbitrary
    // non-negative values.
    Inc(labels ...string)
    // Add adds the given value to the counter. It panics if the value is <
    // 0.
    Add(v float64, labels ...string)
}
```

### func NewBusinessMetricCount

```go
func NewBusinessMetricCount(name string, labels ...string) CounterVec
```

NewBusinessMetricCount business Metric count vec. name or labels should not be empty.

### func NewCounterVec

```go
func NewCounterVec(cfg *CounterVecOpts) CounterVec
```

NewCounterVec .

## type CounterVecOpts

CounterVecOpts is an alias of VectorOpts.

```go
type CounterVecOpts VectorOpts
```

## type Gauge

Gauge stores a numerical value that can be add arbitrarily.

```go
type Gauge interface {
    Metric
    // Sets sets the value to the given number.
    Set(int64)
}
```

### func NewGauge

```go
func NewGauge(opts GaugeOpts) Gauge
```

NewGauge creates a new Gauge based on the GaugeOpts.

## type GaugeOpts

GaugeOpts is an alias of Opts.

```go
type GaugeOpts Opts
```

## type GaugeVec

GaugeVec gauge vec.

```go
type GaugeVec interface {
    // Set sets the Gauge to an arbitrary value.
    Set(v float64, labels ...string)
    // Inc increments the Gauge by 1. Use Add to increment it by arbitrary
    // values.
    Inc(labels ...string)
    // Add adds the given value to the Gauge. (The value can be negative,
    // resulting in a decrease of the Gauge.)
    Add(v float64, labels ...string)
}
```

### func NewBusinessMetricGauge

```go
func NewBusinessMetricGauge(name string, labels ...string) GaugeVec
```

NewBusinessMetricGauge business Metric gauge vec. name or labels should not be empty.

### func NewGaugeVec

```go
func NewGaugeVec(cfg *GaugeVecOpts) GaugeVec
```

NewGaugeVec .

## type GaugeVecOpts

GaugeVecOpts is an alias of VectorOpts.

```go
type GaugeVecOpts VectorOpts
```

## type HistogramVec

HistogramVec gauge vec.

```go
type HistogramVec interface {
    // Observe adds a single observation to the histogram.
    Observe(v int64, labels ...string)
}
```

### func NewBusinessMetricHistogram

```go
func NewBusinessMetricHistogram(name string, buckets []float64, labels ...string) HistogramVec
```

NewBusinessMetricHistogram business Metric histogram vec. name or labels should not be empty.

### func NewHistogramVec

```go
func NewHistogramVec(cfg *HistogramVecOpts) HistogramVec
```

NewHistogramVec new a histogram vec.

## type HistogramVecOpts

HistogramVecOpts is histogram vector opts.

```go
type HistogramVecOpts struct {
    Namespace string
    Subsystem string
    Name      string
    Help      string
    Labels    []string
    Buckets   []float64
}
```

## type Iterator

Iterator iterates the buckets within the window.

```go
type Iterator struct {
    // contains filtered or unexported fields
}
```

### func \(\*Iterator\) Bucket

```go
func (i *Iterator) Bucket() Bucket
```

Bucket gets current bucket.

### func \(\*Iterator\) Next

```go
func (i *Iterator) Next() bool
```

Next returns true util all of the buckets has been iterated.

## type Metric

Metric is a sample interface. Implementations of Metrics in metric package are Counter, Gauge, PointGauge, RollingCounter and RollingGauge.

```go
type Metric interface {
    // Add adds the given value to the counter.
    Add(int64)
    // Value gets the current value.
    // If the metric's type is PointGauge, RollingCounter, RollingGauge,
    // it returns the sum value within the window.
    Value() int64
}
```

## type Opts

Opts contains the common arguments for creating Metric.

```go
type Opts struct {
}
```

## type PointGauge

PointGauge represents a ring window. Every buckets within the window contains one point. When the window is full, the earliest point will be overwrite.

```go
type PointGauge interface {
    Aggregation
    Metric
    // Reduce applies the reduction function to all buckets within the window.
    Reduce(func(Iterator) float64) float64
}
```

### func NewPointGauge

```go
func NewPointGauge(opts PointGaugeOpts) PointGauge
```

NewPointGauge creates a new PointGauge based on PointGaugeOpts.

## type PointGaugeOpts

PointGaugeOpts contains the arguments for creating PointGauge.

```go
type PointGaugeOpts struct {
    // Size represents the bucket size within the window.
    Size int
}
```

## type PointPolicy

PointPolicy is a policy of points within the window. PointPolicy wraps the window and make it seem like ring\-buf. When using PointPolicy, every buckets within the windows contains at more one point. e.g. \[\[1\], \[2\], \[3\]\]

```go
type PointPolicy struct {
    // contains filtered or unexported fields
}
```

### func NewPointPolicy

```go
func NewPointPolicy(window *Window) *PointPolicy
```

NewPointPolicy creates a new PointPolicy.

### func \(\*PointPolicy\) Append

```go
func (p *PointPolicy) Append(val float64)
```

Append appends the given points to the window.

### func \(\*PointPolicy\) Reduce

```go
func (p *PointPolicy) Reduce(f func(Iterator) float64) float64
```

Reduce applies the reduction function to all buckets within the window.

## type RollingCounter

RollingCounter represents a ring window based on time duration. e.g. \[\[1\], \[3\], \[5\]\]

```go
type RollingCounter interface {
    Metric
    Aggregation
    Timespan() int
    // Reduce applies the reduction function to all buckets within the window.
    Reduce(func(Iterator) float64) float64
}
```

### func NewRollingCounter

```go
func NewRollingCounter(opts RollingCounterOpts) RollingCounter
```

NewRollingCounter creates a new RollingCounter bases on RollingCounterOpts.

## type RollingCounterOpts

RollingCounterOpts contains the arguments for creating RollingCounter.

```go
type RollingCounterOpts struct {
    Size           int
    BucketDuration time.Duration
}
```

## type RollingGauge

RollingGauge represents a ring window based on time duration. e.g. \[\[1, 2\], \[1, 2, 3\], \[1,2, 3, 4\]\]

```go
type RollingGauge interface {
    Metric
    Aggregation
    // Reduce applies the reduction function to all buckets within the window.
    Reduce(func(Iterator) float64) float64
}
```

### func NewRollingGauge

```go
func NewRollingGauge(opts RollingGaugeOpts) RollingGauge
```

NewRollingGauge creates a new RollingGauge baseed on RollingGaugeOpts.

## type RollingGaugeOpts

RollingGaugeOpts contains the arguments for creating RollingGauge.

```go
type RollingGaugeOpts struct {
    Size           int
    BucketDuration time.Duration
}
```

## type RollingPolicy

RollingPolicy is a policy for ring window based on time duration. RollingPolicy moves bucket offset with time duration. e.g. If the last point is appended one bucket duration ago, RollingPolicy will increment current offset.

```go
type RollingPolicy struct {
    // contains filtered or unexported fields
}
```

### func NewRollingPolicy

```go
func NewRollingPolicy(window *Window, opts RollingPolicyOpts) *RollingPolicy
```

NewRollingPolicy creates a new RollingPolicy based on the given window and RollingPolicyOpts.

### func \(\*RollingPolicy\) Add

```go
func (r *RollingPolicy) Add(val float64)
```

Add adds the given value to the latest point within bucket.

### func \(\*RollingPolicy\) Append

```go
func (r *RollingPolicy) Append(val float64)
```

Append appends the given points to the window.

### func \(\*RollingPolicy\) Reduce

```go
func (r *RollingPolicy) Reduce(f func(Iterator) float64) (val float64)
```

Reduce applies the reduction function to all buckets within the window.

## type RollingPolicyOpts

RollingPolicyOpts contains the arguments for creating RollingPolicy.

```go
type RollingPolicyOpts struct {
    BucketDuration time.Duration
}
```

## type VectorOpts

VectorOpts contains the common arguments for creating vec Metric..

```go
type VectorOpts struct {
    Namespace string
    Subsystem string
    Name      string
    Help      string
    Labels    []string
}
```

## type Window

Window contains multiple buckets.

```go
type Window struct {
    // contains filtered or unexported fields
}
```

### func NewWindow

```go
func NewWindow(opts WindowOpts) *Window
```

NewWindow creates a new Window based on WindowOpts.

### func \(\*Window\) Add

```go
func (w *Window) Add(offset int, val float64)
```

Add adds the given value to the latest point within bucket where index equals the given offset.

### func \(\*Window\) Append

```go
func (w *Window) Append(offset int, val float64)
```

Append appends the given value to the bucket where index equals the given offset.

### func \(\*Window\) Bucket

```go
func (w *Window) Bucket(offset int) Bucket
```

Bucket returns the bucket where index equals the given offset.

### func \(\*Window\) Iterator

```go
func (w *Window) Iterator(offset int, count int) Iterator
```

Iterator returns the bucket iterator.

### func \(\*Window\) ResetBucket

```go
func (w *Window) ResetBucket(offset int)
```

ResetBucket empties the bucket based on the given offset.

### func \(\*Window\) ResetBuckets

```go
func (w *Window) ResetBuckets(offsets []int)
```

ResetBuckets empties the buckets based on the given offsets.

### func \(\*Window\) ResetWindow

```go
func (w *Window) ResetWindow()
```

ResetWindow empties all buckets within the window.

### func \(\*Window\) Size

```go
func (w *Window) Size() int
```

Size returns the size of the window.

## type WindowOpts

WindowOpts contains the arguments for creating Window.

```go
type WindowOpts struct {
    Size int
}
```



Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
