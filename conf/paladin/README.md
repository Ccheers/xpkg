<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# paladin

```go
import "github.com/ccheers/xpkg/conf/paladin"
```

## Index

- [Variables](<#variables>)
- [func Bool(v *Value, def bool) bool](<#func-bool>)
- [func Close() error](<#func-close>)
- [func Drivers() []string](<#func-drivers>)
- [func Duration(v *Value, def time.Duration) time.Duration](<#func-duration>)
- [func Float32(v *Value, def float32) float32](<#func-float32>)
- [func Float64(v *Value, def float64) float64](<#func-float64>)
- [func Init(args ...interface{}) (err error)](<#func-init>)
- [func Int(v *Value, def int) int](<#func-int>)
- [func Int32(v *Value, def int32) int32](<#func-int32>)
- [func Int64(v *Value, def int64) int64](<#func-int64>)
- [func KeyNamed(key string) string](<#func-keynamed>)
- [func Keys() []string](<#func-keys>)
- [func Register(name string, driver Driver)](<#func-register>)
- [func String(v *Value, def string) string](<#func-string>)
- [func Watch(key string, s Setter) error](<#func-watch>)
- [func WatchEvent(ctx context.Context, keys ...string) <-chan Event](<#func-watchevent>)
- [type Client](<#type-client>)
  - [func NewFile(base string) (Client, error)](<#func-newfile>)
  - [func NewMock(vs map[string]string) Client](<#func-newmock>)
- [type Driver](<#type-driver>)
  - [func GetDriver(name string) (Driver, error)](<#func-getdriver>)
- [type Event](<#type-event>)
- [type EventType](<#type-eventtype>)
- [type Getter](<#type-getter>)
- [type Map](<#type-map>)
  - [func GetAll() *Map](<#func-getall>)
  - [func (m *Map) Exist(key string) bool](<#func-map-exist>)
  - [func (m *Map) Get(key string) *Value](<#func-map-get>)
  - [func (m *Map) Keys() []string](<#func-map-keys>)
  - [func (m *Map) Load() map[string]*Value](<#func-map-load>)
  - [func (m *Map) Store(values map[string]*Value)](<#func-map-store>)
- [type Mock](<#type-mock>)
  - [func (m *Mock) Close() error](<#func-mock-close>)
  - [func (m *Mock) GetAll() *Map](<#func-mock-getall>)
  - [func (m *Mock) WatchEvent(ctx context.Context, key ...string) <-chan Event](<#func-mock-watchevent>)
- [type Setter](<#type-setter>)
- [type TOML](<#type-toml>)
  - [func (m *TOML) Set(text string) error](<#func-toml-set>)
  - [func (m *TOML) UnmarshalText(text []byte) error](<#func-toml-unmarshaltext>)
- [type Value](<#type-value>)
  - [func Get(key string) *Value](<#func-get>)
  - [func NewValue(val interface{}, raw string) *Value](<#func-newvalue>)
  - [func (v *Value) Bool() (bool, error)](<#func-value-bool>)
  - [func (v *Value) Duration() (time.Duration, error)](<#func-value-duration>)
  - [func (v *Value) Float32() (float32, error)](<#func-value-float32>)
  - [func (v *Value) Float64() (float64, error)](<#func-value-float64>)
  - [func (v *Value) Int() (int, error)](<#func-value-int>)
  - [func (v *Value) Int32() (int32, error)](<#func-value-int32>)
  - [func (v *Value) Int64() (int64, error)](<#func-value-int64>)
  - [func (v *Value) Raw() (string, error)](<#func-value-raw>)
  - [func (v *Value) Slice(dst interface{}) error](<#func-value-slice>)
  - [func (v *Value) String() (string, error)](<#func-value-string>)
  - [func (v *Value) Unmarshal(un encoding.TextUnmarshaler) error](<#func-value-unmarshal>)
  - [func (v *Value) UnmarshalFromJSON(dst interface{}) error](<#func-value-unmarshalfromjson>)
  - [func (v *Value) UnmarshalTOML(dst interface{}) error](<#func-value-unmarshaltoml>)
  - [func (v *Value) UnmarshalYAML(dst interface{}) error](<#func-value-unmarshalyaml>)
- [type Watcher](<#type-watcher>)


## Variables

ErrNotExist value key not exist.

```go
var (
    ErrNotExist       = errors.New("paladin: value key not exist")
    ErrTypeAssertion  = errors.New("paladin: value type assertion no match")
    ErrDifferentTypes = errors.New("paladin: value different types")
)
```

## func Bool

```go
func Bool(v *Value, def bool) bool
```

Bool return bool value.

## func Close

```go
func Close() error
```

Close close watcher.

## func Drivers

```go
func Drivers() []string
```

Drivers returns a sorted list of the names of the registered paladin driver.

## func Duration

```go
func Duration(v *Value, def time.Duration) time.Duration
```

Duration parses a duration string. A duration string is a possibly signed sequence of decimal numbers each with optional fraction and a unit suffix, such as "300ms", "\-1.5h" or "2h45m". Valid time units are "ns", "us" \(or "µs"\), "ms", "s", "m", "h".

## func Float32

```go
func Float32(v *Value, def float32) float32
```

Float32 return float32 value.

## func Float64

```go
func Float64(v *Value, def float64) float64
```

Float64 return float32 value.

## func Init

```go
func Init(args ...interface{}) (err error)
```

Init init config client. If confPath is set, it inits file client by default Otherwise we could pass args to init remote client args\[0\]: driver name, string type

## func Int

```go
func Int(v *Value, def int) int
```

Int return int value.

## func Int32

```go
func Int32(v *Value, def int32) int32
```

Int32 return int32 value.

## func Int64

```go
func Int64(v *Value, def int64) int64
```

Int64 return int64 value.

## func KeyNamed

```go
func KeyNamed(key string) string
```

KeyNamed key naming to lower case.

## func Keys

```go
func Keys() []string
```

Keys return values key.

## func Register

```go
func Register(name string, driver Driver)
```

Register makes a paladin driver available by the provided name. If Register is called twice with the same name or if driver is nil, it panics.

## func String

```go
func String(v *Value, def string) string
```

String return string value.

## func Watch

```go
func Watch(key string, s Setter) error
```

Watch watch on a key. The configuration implements the setter interface, which is invoked when the configuration changes.

## func WatchEvent

```go
func WatchEvent(ctx context.Context, keys ...string) <-chan Event
```

WatchEvent watch on multi keys. Events are returned when the configuration changes.

## type Client

Client is config client.

```go
type Client interface {
    Watcher
    Getter
}
```

```go
var (
    // DefaultClient default client.
    DefaultClient Client
)
```

<details><summary>Example</summary>
<p>

ExampleClient is an example client usage. exmaple.toml:

```
bool = true
int = 100
float = 100.1
string = "text"
strings = ["a", "b", "c"]
```

```go
package main

import (
	"context"
	"fmt"

	"github.com/BurntSushi/toml"
	"github.com/ccheers/xpkg/conf/paladin"
)

type exampleConf struct {
	Bool    bool
	Int     int64
	Float   float64
	String  string
	Strings []string
}

func (e *exampleConf) Set(text string) error {
	var ec exampleConf
	if err := toml.Unmarshal([]byte(text), &ec); err != nil {
		return err
	}
	*e = ec
	return nil
}

func main() {
	if err := paladin.Init(); err != nil {
		panic(err)
	}
	var ec exampleConf
	// var setter
	if err := paladin.Watch("example.toml", &ec); err != nil {
		panic(err)
	}
	if err := paladin.Get("example.toml").UnmarshalTOML(&ec); err != nil {
		panic(err)
	}
	// use exampleConf
	// watch event key
	go func() {
		for event := range paladin.WatchEvent(context.TODO(), "key") {
			fmt.Println(event)
		}
	}()
}
```

</p>
</details>

### func NewFile

```go
func NewFile(base string) (Client, error)
```

NewFile new a config file client. conf = /data/conf/app/ conf = /data/conf/app/xxx.toml

### func NewMock

```go
func NewMock(vs map[string]string) Client
```

NewMock new a config mock client.

## type Driver

Driver defined paladin remote client impl each remote config center driver must do 1. implements \`New\` method 2. call \`Register\` to register itself

```go
type Driver interface {
    New() (Client, error)
}
```

### func GetDriver

```go
func GetDriver(name string) (Driver, error)
```

GetDriver returns a driver implement by name.

## type Event

Event is watch event.

```go
type Event struct {
    Event EventType
    Key   string
    Value string
}
```

## type EventType

EventType is config event.

```go
type EventType int
```

```go
const (
    // EventAdd config add event.
    EventAdd EventType = iota
    // EventUpdate config update event.
    EventUpdate
    // EventRemove config remove event.
    EventRemove
)
```

## type Getter

Getter is value getter.

```go
type Getter interface {
    // Get a config value by a config key(may be a sven filename).
    Get(string) *Value
    // GetAll return all config key->value map.
    GetAll() *Map
}
```

## type Map

Map is config map, key\(filename\) \-\> value\(file\).

```go
type Map struct {
    // contains filtered or unexported fields
}
```

<details><summary>Example</summary>
<p>

ExampleMap is an example map usage. exmaple.toml:

```
bool = true
int = 100
float = 100.1
string = "text"
strings = ["a", "b", "c"]

[object]
string = "text"
bool = true
int = 100
float = 100.1
strings = ["a", "b", "c"]
```

```go
package main

import (
	"fmt"

	"github.com/ccheers/xpkg/conf/paladin"
)

func main() {
	var (
		m    paladin.TOML
		strs []string
	)
	// paladin toml
	if err := paladin.Watch("example.toml", &m); err != nil {
		panic(err)
	}
	// value string
	s, err := m.Get("string").String()
	if err != nil {
		s = "default"
	}
	fmt.Println(s)
	// value bool
	b, err := m.Get("bool").Bool()
	if err != nil {
		b = false
	}
	fmt.Println(b)
	// value int
	i, err := m.Get("int").Int64()
	if err != nil {
		i = 100
	}
	fmt.Println(i)
	// value float
	f, err := m.Get("float").Float64()
	if err != nil {
		f = 100.1
	}
	fmt.Println(f)
	// value slice
	if err = m.Get("strings").Slice(&strs); err == nil {
		fmt.Println(strs)
	}
}
```

</p>
</details>

### func GetAll

```go
func GetAll() *Map
```

GetAll return all config map.

### func \(\*Map\) Exist

```go
func (m *Map) Exist(key string) bool
```

Exist check if values map exist a key.

### func \(\*Map\) Get

```go
func (m *Map) Get(key string) *Value
```

Get return get value by key.

### func \(\*Map\) Keys

```go
func (m *Map) Keys() []string
```

Keys return map keys.

### func \(\*Map\) Load

```go
func (m *Map) Load() map[string]*Value
```

Load returns the value set by the most recent Store.

### func \(\*Map\) Store

```go
func (m *Map) Store(values map[string]*Value)
```

Store sets the value of the Value to values map.

## type Mock

Mock is Mock config client.

```go
type Mock struct {
    C   chan Event
    *Map
}
```

### func \(\*Mock\) Close

```go
func (m *Mock) Close() error
```

Close close watcher.

### func \(\*Mock\) GetAll

```go
func (m *Mock) GetAll() *Map
```

GetAll return value map.

### func \(\*Mock\) WatchEvent

```go
func (m *Mock) WatchEvent(ctx context.Context, key ...string) <-chan Event
```

WatchEvent watch multi key.

## type Setter

Setter is value setter.

```go
type Setter interface {
    Set(string) error
}
```

## type TOML

TOML is toml map.

```go
type TOML = Map
```

### func \(\*TOML\) Set

```go
func (m *TOML) Set(text string) error
```

Set set the map by value.

### func \(\*TOML\) UnmarshalText

```go
func (m *TOML) UnmarshalText(text []byte) error
```

UnmarshalText implemented toml.

## type Value

Value is config value, maybe a json/toml/ini/string file.

```go
type Value struct {
    // contains filtered or unexported fields
}
```

### func Get

```go
func Get(key string) *Value
```

Get return value by key.

### func NewValue

```go
func NewValue(val interface{}, raw string) *Value
```

NewValue new a value

### func \(\*Value\) Bool

```go
func (v *Value) Bool() (bool, error)
```

Bool return bool value.

### func \(\*Value\) Duration

```go
func (v *Value) Duration() (time.Duration, error)
```

Duration parses a duration string. A duration string is a possibly signed sequence of decimal numbers each with optional fraction and a unit suffix, such as "300ms", "\-1.5h" or "2h45m". Valid time units are "ns", "us" \(or "µs"\), "ms", "s", "m", "h".

### func \(\*Value\) Float32

```go
func (v *Value) Float32() (float32, error)
```

Float32 return float32 value.

### func \(\*Value\) Float64

```go
func (v *Value) Float64() (float64, error)
```

Float64 return float64 value.

### func \(\*Value\) Int

```go
func (v *Value) Int() (int, error)
```

Int return int value.

### func \(\*Value\) Int32

```go
func (v *Value) Int32() (int32, error)
```

Int32 return int32 value.

### func \(\*Value\) Int64

```go
func (v *Value) Int64() (int64, error)
```

Int64 return int64 value.

### func \(\*Value\) Raw

```go
func (v *Value) Raw() (string, error)
```

Raw return raw value.

### func \(\*Value\) Slice

```go
func (v *Value) Slice(dst interface{}) error
```

Slice scan a slice interface, if slice has element it will be discard.

### func \(\*Value\) String

```go
func (v *Value) String() (string, error)
```

String return string value.

### func \(\*Value\) Unmarshal

```go
func (v *Value) Unmarshal(un encoding.TextUnmarshaler) error
```

Unmarshal is the interface implemented by an object that can unmarshal a textual representation of itself.

### func \(\*Value\) UnmarshalFromJSON

```go
func (v *Value) UnmarshalFromJSON(dst interface{}) error
```

UnmarshalFromJSON unmarhsal json to struct.

### func \(\*Value\) UnmarshalTOML

```go
func (v *Value) UnmarshalTOML(dst interface{}) error
```

UnmarshalTOML unmarhsal toml to struct.

### func \(\*Value\) UnmarshalYAML

```go
func (v *Value) UnmarshalYAML(dst interface{}) error
```

UnmarshalYAML unmarshal yaml to struct.

## type Watcher

Watcher is config watcher.

```go
type Watcher interface {
    WatchEvent(context.Context, ...string) <-chan Event
    Close() error
}
```



Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
