<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# fanout

```go
import "github.com/ccheers/xpkg/sync/pipeline/fanout"
```

<details><summary>Example</summary>
<p>

```go
package main

import "context"

// addCache 加缓存的例子
func addCache(c context.Context, id, value int) {
	// some thing...
}

func main() {
	// 这里只是举个例子 真正使用的时候 应该用bm/rpc 传过来的context
	var c = context.Background()
	// 新建一个fanout 对象 名称为cache 名称主要用来上报监控和打日志使用 最好不要重复
	// (可选参数) worker数量为1 表示后台只有1个线程在工作
	// (可选参数) buffer 为1024 表示缓存chan长度为1024 如果chan慢了 再调用Do方法就会报错 设定长度主要为了防止OOM
	cache := New("cache", Worker(1), Buffer(1024))
	// 需要异步执行的方法
	// 这里传进来的c里面的meta信息会被复制 超时会忽略 addCache拿到的context已经没有超时信息了
	cache.Do(c, func(c context.Context) { addCache(c, 0, 0) })
	// 程序结束的时候关闭fanout 会等待后台线程完成后返回
	cache.Close()
}
```

</p>
</details>

## Index

- [Variables](<#variables>)
- [type Fanout](<#type-fanout>)
  - [func New(name string, opts ...Option) *Fanout](<#func-new>)
  - [func (c *Fanout) Close() error](<#func-fanout-close>)
  - [func (c *Fanout) Do(ctx context.Context, f func(ctx context.Context)) (err error)](<#func-fanout-do>)
- [type Option](<#type-option>)
  - [func Buffer(n int) Option](<#func-buffer>)
  - [func Worker(n int) Option](<#func-worker>)


## Variables

```go
var (
    // ErrFull chan full.
    ErrFull = errors.New("fanout: chan full")
)
```

## type Fanout

Fanout async consume data from chan.

```go
type Fanout struct {
    // contains filtered or unexported fields
}
```

### func New

```go
func New(name string, opts ...Option) *Fanout
```

New new a fanout struct.

### func \(\*Fanout\) Close

```go
func (c *Fanout) Close() error
```

Close close fanout

### func \(\*Fanout\) Do

```go
func (c *Fanout) Do(ctx context.Context, f func(ctx context.Context)) (err error)
```

Do save a callback func.

## type Option

Option fanout option

```go
type Option func(*options)
```

### func Buffer

```go
func Buffer(n int) Option
```

Buffer specifies the buffer of fanout

### func Worker

```go
func Worker(n int) Option
```

Worker specifies the worker of fanout



Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
